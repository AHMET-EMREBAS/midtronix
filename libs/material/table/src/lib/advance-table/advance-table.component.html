<div class="table-container col">
  <div class="search-container">
    <mat-form-field appearance="fill">
      <input
        type="search"
        #searchInput="ngModel"
        ngModel
        matInput
        placeholder="Search"
        autocomplete="off"
        (input)="search$.next(searchInput.value)"
        style="width: 100%"
      />
    </mat-form-field>
  </div>

  <mat-table
    #tableRef
    *ngIf="data$ | async as data"
    [dataSource]="data"
    matSort
    matSortActive="created"
    matSortDisableClear
    matSortDirection="desc"
    (matSortChange)="sortChangeHandler($event)"
  >
    <!-- First column -->
    <ng-container [matColumnDef]="firstColumn.name">
      <mat-header-cell *matHeaderCellDef mat-sort-header disableClear>
        <mat-checkbox
          [indeterminate]="isSomeSelected(data)"
          [checked]="isAllSelected(data)"
          (change)="selectAll($event, data)"
        ></mat-checkbox>
      </mat-header-cell>
      <mat-cell *matCellDef="let row">
        <mat-checkbox
          (change)="toggleSelect($event, row)"
          [checked]="isSelected(row)"
        >
        </mat-checkbox>
        <button
          class="open-in-new-button"
          mat-icon-button
          (click)="openItemEditor(row)"
          color="primary"
        >
          <mat-icon>open_in_new</mat-icon>
        </button>
      </mat-cell>
    </ng-container>

    @for(c of sortedTableColumns; track c){
    <ng-container [matColumnDef]="c.name">
      <mat-header-cell *matHeaderCellDef mat-sort-header disableClear>
        {{ c.label || c.name || '' | titlecase }}
      </mat-header-cell>
      <mat-cell
        *matCellDef="let row"
        [class]="c.statusClass && c.statusClass(row)"
      >
        {{ c.mapValue ? c.mapValue(row) : row[c.name] }}
      </mat-cell>
    </ng-container>
    }

    <!-- Last Column -->
    <ng-container [matColumnDef]="lastColumn.name">
      <mat-header-cell *matHeaderCellDef mat-sort-header disableClear>
      </mat-header-cell>
      <mat-cell *matCellDef="let row">
        <!-- Last Column Content -->

        <!-- <button
          class="open-in-new-button"
          mat-icon-button
          (click)="openItemEditor(row)"
          color="accent"
        >
          <mat-icon>settings</mat-icon>
        </button> -->
      </mat-cell>
    </ng-container>

    <!-- Header configuration -->
    <mat-header-row *matHeaderRowDef="tableColumnNames"></mat-header-row>
    <mat-row *matRowDef="let row; columns: tableColumnNames"></mat-row>
  </mat-table>

  <div class="grow-1"></div>
  <mat-paginator
    #paginatorRef
    [length]="count$ | async"
    [pageIndex]="pageIndex"
    [pageSize]="pageSize"
    [pageSizeOptions]="pageSizeOptions"
    (page)="pageChangeHandler($event)"
  ></mat-paginator>
</div>
